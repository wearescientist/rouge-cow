# 肉鸽牛牛 v0.10.1 紧急修复

## 修复内容

### 1. ✅ UI布局彻底重构（按图二设计）

**问题：**
- 旧UI还在（左上角黑框）
- 两侧UI太小
- 游戏画面被拉伸变形

**修复：**
```
┌─────────────────────────────────────────────────────────────┐
│  [左侧边栏]      [   游戏区域   ]      [右侧边栏]           │
│  200px宽        保持原始比例          200px宽               │
│                                                                │
│  🐮 角色状态                             🗺️ 地图            │
│  ❤️ 生命 6/6                            [小地图]            │
│  ⭐ 等级 Lv.1                            🎒 道具            │
│  💰 金币 100                             [20格背包]         │
│  📍 层数 1/6                             📊 统计            │
│                                           击杀/探索          │
│  🔫 武器装备                                                 │
│  [武器列表]                                                  │
│                                                                │
│  💎 材料                                                     │
└─────────────────────────────────────────────────────────────┘
        [顶部分数: 8,450]  [底部状态: 层数/敌人/房间状态]
```

**实现：**
- 使用CSS Grid/Flexbox三栏布局
- 左右侧边栏固定200px宽度
- 中间游戏区域使用 `object-fit: contain` 保持原始比例
- 移除canvas内所有UI绘制，全部移到HTML

---

### 2. ✅ 游戏画面比例保持原始比例

**问题：**
- 游戏画面被拉伸
- 2700x1800的房间被压缩变形

**修复：**
```css
#gameCanvas {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;  /* 保持比例 */
}
```

---

### 3. ✅ 修复门被墙挡住的问题

**问题：**
- 门完全嵌在墙内
- 玩家走不到门的位置

**修复：**
1. 先在墙上挖洞（用地板颜色覆盖门区域）
2. 障碍物绘制时跳过门区域
3. 门在所有障碍物之上绘制
4. 门添加边框和把手，更醒目

```javascript
// 1. 墙上挖洞
ctx.fillStyle = floorColor;
ctx.fillRect(doorX, doorY, doorW, doorH);

// 2. 跳过门的障碍物
if (obs overlaps door) continue;

// 3. 最后绘制门
ctx.fillStyle = door.open ? '#4a4' : '#a44';
ctx.fillRect(doorX, doorY, doorW, doorH);
```

---

### 4. ✅ 修复出生点与地形重合

**问题：**
- 玩家出生在障碍物内
- 无法移动

**修复：**
添加智能出生点选择：
```javascript
const safePositions = [
    {x: centerX, y: centerY},        // 中心
    {x: centerX - 200, y: centerY},  // 左
    {x: centerX + 200, y: centerY},  // 右
    {x: centerX, y: centerY - 200},  // 上
    {x: centerX, y: centerY + 200},  // 下
    // ... 更多备选位置
];

// 检查每个位置是否与障碍物重叠
for (const pos of safePositions) {
    if (!hitObstacle(pos)) {
        player.position = pos;
        break;
    }
}
```

---

### 5. ✅ 移除角色下方棕色腿效果

**问题：**
- 角色下方有棕色方块（模拟腿）
- 但角色精灵图本身就有脚
- 效果很怪，没必要

**修复：**
删除绘制棕色腿的代码，只保留：
1. 精灵图绘制（如果加载成功）
2. 或者简化版程序化绘制（无额外腿）

---

## 文件变更

| 文件 | 变更 |
|------|------|
| `index.html` | 完全重写CSS布局、修复绘制逻辑、移除腿效果、修复出生点 |

---

## 测试检查清单

- [x] 三栏布局正常显示
- [x] 游戏画面保持比例，不拉伸
- [x] 门在墙前面，可以正常通过
- [x] 玩家不会出生在障碍物内
- [x] 角色下方没有棕色方块
- [x] 侧边栏信息正确更新
- [x] 分数显示正常

---

## 后续优化建议

1. **自适应侧边栏宽度**：根据屏幕大小动态调整
2. **移动端适配**：添加触摸控制
3. **UI美化**：添加更多图标和动画效果
