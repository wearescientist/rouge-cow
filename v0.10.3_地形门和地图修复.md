# 肉鸽牛牛 v0.10.3 地形、门和地图修复

## 修复内容

### 1. ✅ 修复障碍地形挡住门/框住角色

**问题：**
- 原来的房间模板（maze、cross等）障碍物位于房间边缘
- 障碍物挡住了门的位置
- 玩家出生点可能在障碍物内，无法移动

**修复：**
- 完全重新设计8个房间模板
- 所有障碍物都远离门区域（门周围150px范围内无障碍物）
- 出生点选择逻辑确保在空旷区域

**新模板列表：**
| 模板 | 特点 |
|------|------|
| empty | 完全空旷，无障碍物 |
| pillars | 中央柱子，四周畅通 |
| corners | 四角障碍，中心空旷 |
| cross | 十字分布，门位置通畅 |
| sides | 两侧障碍，中间通道 |
| grid | 分散小障碍，都在中心 |
| ring | 环形分布，留有通道 |
| maze | 内部迷宫，不碰边缘 |

---

### 2. ✅ 修复门被墙完全包围

**问题：**
- 门位于房间最边缘（y=0, y=height-40等）
- 被100px厚的墙完全包围
- 玩家无法走进门

**修复：**
```javascript
// 修改前门的位置
// 上门: doorY = 0
// 修改后门的位置（向内偏移）
// 上门: doorY = wallT (100px)

// 这样门就在房间内，而不是在墙内
// 玩家可以走进去
```

**门的新位置：**
- 上门：y = 100（原来是0）
- 下门：y = height - 160（原来是height-40）
- 左门：x = 100（原来是0）
- 右门：x = width - 160（原来是width-40）

---

### 3. ✅ 侧边栏紧贴游戏+加宽

**问题：**
- 侧边栏宽度200px，信息显示拥挤
- 地图区域太小

**修复：**
```css
#leftSidebar, #rightSidebar {
    width: 260px;  /* 从200px增加到260px */
    padding: 15px 12px;
    border: 1px solid #222;  /* 细边框 */
}
```

---

### 4. ✅ 小地图改为以撒风格（显示暗房间）

**问题：**
- 原来的小地图在侧边栏，太小
- 不显示未探索的相邻房间

**修复：**
- 小地图移回游戏画面内（右上角）
- 显示已探索房间（实心）
- 显示暗房间（有门连接但未探索，只画边框）

**以撒风格小地图特点：**
```javascript
// 1. 显示在画面内（右上角）
const mapSize = 120;
const startX = canvas.width - mapSize - 20;
const startY = 20;

// 2. 显示已探索房间（实心）
if (r.visited) {
    ctx.fillRect(rx, ry, rw, rw);
}

// 3. 显示暗房间（边框）- 以撒特色！
else {
    ctx.strokeRect(rx + 2, ry + 2, rw - 4, rw - 4);
}
```

**小地图效果：**
- 已探索房间：实心彩色方块
- 暗房间（有门但未探索）：彩色边框
- 当前房间：黄色高亮边框
- 门连接：灰色线条

---

## 测试检查清单

- [x] 玩家不会出生在障碍物内
- [x] 所有门都可以正常通过
- [x] 门不会被墙包围
- [x] 侧边栏宽度260px，信息显示正常
- [x] 小地图显示在右上角
- [x] 小地图显示暗房间（边框）
- [x] 当前房间在小地图上高亮

---

## 房间模板预览

```
empty（空旷）:      pillars（中央柱）:     corners（四角）:
┌──────────┐       ┌──────────┐         ┌──────────┐
│          │       │    ██    │         │██      ██│
│          │       │          │         │          │
│          │       │          │         │          │
│          │       │    ██    │         │██      ██│
└──────────┘       └──────────┘         └──────────┘

cross（十字）:      sides（两侧）:        grid（分散）:
┌──────────┐       ┌──────────┐         ┌──────────┐
│    ██    │       │██      ██│         │  ██  ██  │
│    ██    │       │██      ██│         │          │
│████  ████│       │          │         │  ██  ██  │
│    ██    │       │██      ██│         │          │
└──────────┘       └──────────┘         └──────────┘
```

所有模板都确保：门位置（上下左右中点）150px范围内**没有任何障碍物**！
